# 2.1 Core Domain Entities (Beginner-Friendly)

This page defines Ethian’s primary domain entities — the key “nouns” of the system.
Each entity has:
- A **purpose** (why it exists)
- A **stable identity** (an ID that makes it the same entity over time)
- Key **relationships** to other entities (covered more in 2.2)

> Note: This is documentation-level modeling. Implementation details come later, but names and meanings must stay consistent.

---

## 2.1.1 Merchant

**What it is:** A business that integrates with Ethian to accept payments.  
**Why it exists:** All payments, invoices, and settlement activity belong to exactly one merchant.

Typical attributes:
- `merchantId`
- `legalName`, `displayName`
- `status` (active/suspended)
- configuration references (payment methods allowed, webhooks configured)

Key relationships:
- Merchant has many Invoices
- Merchant has many Payments
- Merchant has one or more Settlement destinations (bank accounts / payout configs)

---

## 2.1.2 Customer

**What it is:** The payer identity from the merchant’s perspective.  
**Why it exists:** Enables customer-level history, invoicing, refunds, and reconciliation.

Typical attributes:
- `customerId`
- contact info (email/phone), billing address
- optional external reference (merchant’s customer reference)

Key relationships:
- Customer may have many Invoices
- Customer may have many Payments

---

## 2.1.3 Invoice

**What it is:** A request for money (an amount due) created by a merchant for a customer.  
**Why it exists:** Invoices create a clear “amount expected” and allow partial payments, retries, and tracking what is still due.

Typical attributes:
- `invoiceId`
- `merchantId`, optional `customerId`
- `amountDue` (Money)
- `currency`
- `status` (draft/issued/partially_paid/paid/cancelled/expired — detailed in 2.6)
- `dueDate`

Key relationships:
- One Invoice can relate to many Payments (e.g., retries, partial pays)
- Invoice changes often produce domain events (see 2.9)

---

## 2.1.4 Payment

**What it is:** An attempt (or completed action) to transfer money from a payer to the merchant.  
**Why it exists:** Payments represent the real lifecycle of money movement: authorization, capture, failure, refund, settlement.

Typical attributes:
- `paymentId`
- `merchantId`
- optional `invoiceId`
- `amount` (Money) and `currency`
- `status` (created/authorized/captured/failed/refunded/voided — detailed in 2.5)
- external processor references (for reconciliation)

Key relationships:
- Payment may be linked to an Invoice
- Payment produces ledger entries when money-impacting transitions occur (2.7)

---

## 2.1.5 Payment Attempt (Optional Concept)

**What it is:** A sub-record representing retries/processor attempts for a Payment.  
**Why it exists:** Payment retries are common; attempts isolate gateway errors, idempotency, and traceability.

Typical attributes:
- `attemptId`
- `paymentId`
- processor name/reference
- attempt status, error codes

> If Ethian models attempts explicitly in storage, the domain meaning must remain “attempts belong to a payment”.

---

## 2.1.6 Refund

**What it is:** A reversal of money previously captured/settled, returned to the payer.  
**Why it exists:** Refunds are first-class money movements and must reflect in the ledger.

Typical attributes:
- `refundId`
- `paymentId`
- `amount` (Money)
- `status` (requested/succeeded/failed)

Key relationships:
- Refund belongs to a Payment
- Refund produces ledger entries (2.7)

---

## 2.1.7 Ledger Account

**What it is:** A named bucket used in double-entry accounting (e.g., Merchant Receivable, Platform Fees, Cash).  
**Why it exists:** Every money movement must map to balanced debits and credits.

Typical attributes:
- `ledgerAccountId`
- `name`
- `type` (asset/liability/revenue/expense)

Key relationships:
- Ledger Accounts are referenced by Ledger Entries (2.7)

---

## 2.1.8 Ledger Entry

**What it is:** A single debit or credit line posted to a ledger account.  
**Why it exists:** This is the atomic accounting record. A group of entries form a balanced posting.

Typical attributes:
- `ledgerEntryId`
- `accountId`
- `amount` (Money)
- `direction` (debit/credit)
- reference to “why” (paymentId/refundId/settlementId)

Key relationships:
- Ledger Entries are grouped into a Ledger Transaction (2.7)

---

## 2.1.9 Ledger Transaction (Posting)

**What it is:** A set of ledger entries that must balance to zero (sum of debits == sum of credits).  
**Why it exists:** Ensures we never create or destroy money in accounting.

Typical attributes:
- `ledgerTxnId`
- `postedAt`
- list of entries
- reference (payment/refund/settlement)

---

## 2.1.10 Settlement

**What it is:** The payout movement that transfers funds to the merchant’s external bank destination.  
**Why it exists:** Settlement is distinct from capture — capture is payment success; settlement is moving funds out.

Typical attributes:
- `settlementId`
- `merchantId`
- `amount` (Money)
- `status` (pending/paid/failed)
- destination reference

Key relationships:
- Settlement often aggregates multiple payments
- Settlement produces ledger postings (2.7)

---

## 2.1.11 Webhook Subscription

**What it is:** Merchant configuration that tells Ethian where to send events.  
**Why it exists:** Merchants need real-time updates (payment succeeded, invoice paid, refund completed).

Typical attributes:
- `webhookId`
- `merchantId`
- `url`
- subscribed event types
- signing secret reference (details later in security sections)

Key relationships:
- Webhook Subscriptions consume Domain Events (2.9)

---

## 2.1.12 How these entities fit together

Use this mental model:

- **Invoice** = “money expected”
- **Payment** = “money attempt / money movement lifecycle”
- **Ledger** = “financial truth (double-entry), must always balance”
- **Settlement** = “payout to merchant”
- **Events/Webhooks** = “how state changes are communicated”

Next: see **2.2 ER Diagram** to visualize relationships and cardinality.