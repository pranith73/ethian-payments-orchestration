\# 2.2 ER Diagram (Relationships)



This section shows how the core domain entities relate to each other at the data/model level.

It is a structural view (who references whom) and helps validate the domain model from Section 2.1.



---



\## 2.2.1 Entities Included



\- Merchant

\- Customer

\- Product

\- Invoice

\- Payment

\- LedgerEntry

\- Settlement

\- DomainEvent



---



\## 2.2.2 Relationship Rules (Cardinality \& Direction)



\### Merchant Relationships

\- \*\*Merchant → Invoice\*\*: 1 Merchant has many Invoices (each Invoice belongs to 1 Merchant)

\- \*\*Merchant → Payment\*\*: 1 Merchant has many Payments (each Payment belongs to 1 Merchant)

\- \*\*Merchant → Settlement\*\*: 1 Merchant has many Settlements (each Settlement belongs to 1 Merchant)

\- \*\*Merchant → LedgerEntry\*\*: 1 Merchant has many Ledger Entries (each LedgerEntry belongs to 1 Merchant)



\### Customer Relationships

\- \*\*Customer → Invoice\*\*: 1 Customer can have many Invoices (each Invoice belongs to 1 Customer)

\- \*\*Customer → Payment\*\*: 1 Customer can initiate many Payments (each Payment belongs to 1 Customer conceptually)



\### Invoice Relationships

\- \*\*Invoice → Payment\*\*: 1 Invoice can have many Payments (retries, partials); each Payment belongs to 1 Invoice

\- \*\*Invoice → Product\*\*: Invoice contains Products (modeled at ER level as association)



\### Payment / Ledger / Settlement

\- \*\*Payment → LedgerEntry\*\*: 1 Payment produces many Ledger Entries (append-only history)

\- \*\*Settlement → Payment\*\*: 1 Settlement bundles many Payments (payout batching)

\- \*\*Settlement → LedgerEntry\*\*: 1 Settlement produces Ledger Entries (payout recording)



\### Domain Events

\- \*\*Payment → DomainEvent\*\*: Payment emits Domain Events

\- \*\*Invoice → DomainEvent\*\*: Invoice emits Domain Events

\- \*\*Settlement → DomainEvent\*\*: Settlement emits Domain Events



---



\## 2.2.3 Mermaid ER Diagram (Primary)



> This Mermaid ER diagram is the authoritative relationship picture for GitHub rendering.



```mermaid

erDiagram

&nbsp;   MERCHANT ||--o{ INVOICE : issues

&nbsp;   MERCHANT ||--o{ PAYMENT : receives

&nbsp;   MERCHANT ||--o{ SETTLEMENT : paid\_through

&nbsp;   MERCHANT ||--o{ LEDGER\_ENTRY : has



&nbsp;   CUSTOMER ||--o{ INVOICE : billed\_for

&nbsp;   CUSTOMER ||--o{ PAYMENT : initiates



&nbsp;   PRODUCT }o--o{ INVOICE : appears\_on



&nbsp;   INVOICE ||--o{ PAYMENT : paid\_by



&nbsp;   PAYMENT ||--o{ LEDGER\_ENTRY : produces

&nbsp;   SETTLEMENT ||--o{ PAYMENT : bundles

&nbsp;   SETTLEMENT ||--o{ LEDGER\_ENTRY : records



&nbsp;   PAYMENT ||--o{ DOMAIN\_EVENT : emits

&nbsp;   INVOICE ||--o{ DOMAIN\_EVENT : emits

&nbsp;   SETTLEMENT ||--o{ DOMAIN\_EVENT : emits



