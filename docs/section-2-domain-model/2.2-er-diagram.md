# 2.2 ER Diagram — Domain Relationships (Beginner-Friendly)

This page explains how the core Ethian domain objects relate to each other.
It is written for beginners and is designed to be readable directly on GitHub.

---

## 2.2.1 Quick Legend (How to read the diagram)

Mermaid ER notation uses symbols to show “how many”:

- `||` = exactly one  
- `o|` = zero or one (optional)  
- `o{` = zero or many  
- `|{` = one or many  

Examples:
- `MERCHANT ||--o{ INVOICE` means: **one Merchant can have many Invoices**  
- `INVOICE ||--o{ PAYMENT` means: **one Invoice can have many Payments** (e.g., retries / partial payments)

---

## 2.2.2 Core Story (Read this first)

Ethian’s business flow is:

1. **A Merchant issues an Invoice** to a Customer  
2. **A Customer makes a Payment** for that Invoice  
3. **Ledger Entries record the accounting trail** for payments and payouts  
4. **Settlements pay out to the Merchant**  
5. Important state changes produce **Domain Events** (used later for workflows and integrations)

Keep this story in mind while reading the diagram.

---

## 2.2.3 Mermaid ER Diagram (Primary)

> This Mermaid ER diagram is the authoritative relationship picture for GitHub rendering.

```mermaid
erDiagram

    %% =========================================================
    %% MERCHANT-CENTERED RELATIONSHIPS
    %% =========================================================

    MERCHANT ||--o{ INVOICE : "issues invoices"
    MERCHANT ||--o{ PAYMENT : "receives payments (via Ethian)"
    MERCHANT ||--o{ SETTLEMENT : "is paid out through"
    MERCHANT ||--o{ LEDGER_ENTRY : "has ledger history"

    %% =========================================================
    %% CUSTOMER RELATIONSHIPS
    %% =========================================================

    CUSTOMER ||--o{ INVOICE : "is billed by invoices"
    CUSTOMER ||--o{ PAYMENT : "initiates payments"

    %% =========================================================
    %% PRODUCT AND INVOICE LINEAGE (SIMPLIFIED)
    %% =========================================================

    PRODUCT }o--o{ INVOICE : "appears on invoices"

    %% =========================================================
    %% PAYMENT, INVOICE, SETTLEMENT + LEDGER LINKS
    %% =========================================================

    INVOICE ||--o{ PAYMENT : "is paid by payments"
    PAYMENT ||--o{ LEDGER_ENTRY : "produces ledger entries"

    SETTLEMENT ||--o{ PAYMENT : "bundles payments"
    SETTLEMENT ||--o{ LEDGER_ENTRY : "records payout ledger entries"

    %% =========================================================
    %% DOMAIN EVENTS (ENTITY EMITS EVENTS)
    %% =========================================================

    PAYMENT ||--o{ DOMAIN_EVENT : "emits events"
    INVOICE ||--o{ DOMAIN_EVENT : "emits events"
    SETTLEMENT ||--o{ DOMAIN_EVENT : "emits events"
